const TelegramBot = require("node-telegram-bot-api");
require("dotenv").config();

// === Создаём бота через polling
const bot = new TelegramBot(process.env.token, { polling: true });

const blocks = {
  neck: [
    "🔁 Наклоны головы вперёд и назад — по 10 раз",
    "🔁 Наклоны головы влево и вправо — по 10 раз",
    "🔄 Круговые движения плечами — 10 раз",
    "🔄 Медленные круги головой — по 5 раз в каждую сторону",
    "📏 Наклоните голову к плечу и задержитесь на 5 секунд. Повторите 3 раза с каждой стороны",
    "🧠 Давите головой назад на руки, положенные на затылок (5 секунд). Повторите 3 раза",
  ],
  eyes: [
    "👀 Переводите взгляд вверх-вниз — 10 раз",
    "👀 Влево-вправо — 10 раз",
    "🔄 Круговые движения глазами — 5 раз по часовой, 5 — против",
    "✨ Быстро моргайте в течение 30 секунд",
    "🌳 Посмотрите в окно на дальний объект — 20 секунд, потом обратно. Повторите 3 раза",
    "💪 Сильно зажмурьте глаза на 3 секунды, затем расслабьтесь. Повторите 5 раз",
  ],
  back: [
    "🧍‍♂️ Встаньте, сделайте наклоны вперёд — 10 раз",
    "🪑 Сидя на стуле, повороты корпуса влево и вправо — 10 раз",
    "💪 Вращения плечами — 6–8 в одну сторону, затем обратно",
    "🌀 Вращения руками — 6–8 в одну сторону, затем обратно",
    "🤲 Сгибайте руки с разжиманием пальцев — 10–12 раз",
    "↩ Повороты корпуса с согнутыми руками — 10–12 раз",
    "🧎‍♂️ Наклоны с касанием бедер — 8–10 раз",
  ],
  breathing: [
    "🌬 Упражнение 4-7-8: вдох на 4 секунды, задержка на 7, выдох на 8. Повторите 3–4 раза.",
    "🫁 Глубокое дыхание животом: положите руку на живот и медленно вдыхайте через нос. Затем выдох через рот. 5 раз.",
    "🧘‍♂️ Дыхание квадратом: вдох — 4 сек, задержка — 4, выдох — 4, пауза — 4. Повторите 4 цикла.",
    "😮‍💨 Осознанное дыхание: сосредоточьтесь только на дыхании. Медленно вдохните и выдохните. 2–3 минуты.",
    "🔁 Альтернативное дыхание: зажмите правую ноздрю, вдох левой, затем наоборот. 5 циклов.",
  ],
};

bot.onText(/\/start/, (msg) => {
  bot.sendMessage(msg.chat.id, `Привет, ${msg.from.first_name || "друг"}! ✨\nВыбери зону для разминки:`, {
    reply_markup: {
      inline_keyboard: [
        [{ text: "🧠 Шея", callback_data: "neck" }],
        [{ text: "👁️ Глаза", callback_data: "eyes" }],
        [{ text: "🧍‍♂️ Спина", callback_data: "back" }],
        [{ text: "🫁 Дыхание", callback_data: "breathing" }]
      ]
    }
  });
});

bot.on("callback_query", async (query) => {
  const chatId = query.message.chat.id;
  const type = query.data;
  const block = blocks[type];

  await bot.answerCallbackQuery(query.id);

  if (!block) return;

  await bot.sendMessage(chatId, `Начинаем разминку для: ${type}`);

  for (const step of block) {
    await bot.sendMessage(chatId, step);
    await new Promise((res) => setTimeout(res, 2000));
  }
});
